////////////////////////////////////////////////////////////////////////////////
// UCSD CSE 168 - basic ray tracer
// Author: Monica Liu
// Spring 2014
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//scene generation
////////////////////////////////////////////////////////////////////////////////


////////////////////////////////////////////////////////////////////////////////

void project3() {
    // Create scene
    Scene scn;
    scn.SetSkyColor(Color(0.8f, 0.9f, 1.0f));
    
    // Materials
    const int nummtls=4;
    AshikhminMaterial mtl[nummtls];
    
    // Diffuse
    mtl[0].SetSpecularLevel(0.0f);
    mtl[0].SetDiffuseLevel(1.0f);
    mtl[0].SetDiffuseColor(Color(0.7f,0.7f,0.7f));
    
    // Roughened copper
    mtl[1].SetDiffuseLevel(0.0f);
    mtl[1].SetSpecularLevel(1.0f);
    mtl[1].SetSpecularColor(Color(0.9f,0.6f,0.5f));
    mtl[1].SetRoughness(100.0f,100.0f);
    
    // Anisotropic gold
    mtl[2].SetDiffuseLevel(0.0f);
    mtl[2].SetSpecularLevel(1.0f);
    mtl[2].SetSpecularColor(Color(0.95f,0.7f,0.3f));
    mtl[2].SetRoughness(1.0f,1000.0f);
    
    // Red plastic
    mtl[3].SetDiffuseColor(Color(1.0f,0.1f,0.1f));
    mtl[3].SetDiffuseLevel(0.8f);
    mtl[3].SetSpecularLevel(0.2f);
    mtl[3].SetSpecularColor(Color(1.0f,1.0f,1.0f));
    mtl[3].SetRoughness(1000.0f,1000.0f);
    
    // Load dragon mesh
    MeshObject dragon;
    concat = APP_PATH + "data/dragon.ply";
    dragon.LoadPLY(concat.c_str());
    dragon.Smooth();
    
    // Create box tree
    BoxTreeObject tree;
    tree.Construct(dragon);
    
    //test diffuse only
    LambertMaterial l;
    l.SetDiffuseColor(Color::WHITE);
    l.SetDiffuseLevel(0.6f);
    
    // Create dragon instances
    Matrix34 mtx;
    for(int i=0;i<nummtls;i++) {
        InstanceObject *inst = new InstanceObject(tree);
        mtx.d.Set(0.0f,0.0f,-0.1f*float(i));
        inst->SetMatrix(mtx);
        inst->SetMaterial(&mtl[i]);
        //inst->SetMaterial(&l);
        scn.AddObject(*inst);
    }
    
    // Create ground
    LambertMaterial lambert;
    lambert.SetDiffuseColor(Color(0.3f,0.3f,0.35f));
    MeshObject ground;
    ground.MakeBox(2.0f,0.11f,2.0f,&lambert);
    scn.AddObject(ground);
    
    // Create lights
    DirectLight sunlgt;
    sunlgt.SetBaseColor(Color(1.0f, 1.0f, 0.9f));
    sunlgt.SetIntensity(1.0f);
    Vector3 temp = Vector3(2.0f, -3.0f, -2.0f);
    sunlgt.SetDirection(temp);
    scn.AddLight(sunlgt);
    
    // Create camera
    Camera cam;
    cam.LookAt(Vector3(-0.5f,0.25f,-0.2f),Vector3(0.0f,0.15f,-0.15f),
               Vector3(0.0f, 1.0f, 0.0f));
    cam.SetFOV(40.0f); cam.SetAspect(1.33f);
    cam.SetResolution(800,600);
    cam.SetSuperSample(6);
    
    //Render image
    cam.Render(scn);
    concat = APP_PATH + "project3.bmp";
    cam.SaveBitmap(concat.c_str());
    
    // Set camera for extra credit image 1
    cam.LookAt(Vector3(-0.2f,0.15f,0.3f),Vector3(0.0f,0.15f,-0.15f),
               Vector3(0.0f, 1.0f, 0.0f));
    cam.SetFOV(40.0f); cam.SetAspect(1.33f);
    cam.SetResolution(800,600);
    cam.SetSuperSample(2);
    cam.SetFocalPlane(0.2f);
    cam.SetAperture(0.004f);
    
    // Render image
    cam.Render(scn);
    concat = APP_PATH + "project3_extra1.bmp";
    cam.SaveBitmap(concat.c_str());
}

////////////////////////////////////////////////////////////////////////////////

void extra() {
    // Create scene
    Scene scn;
    scn.SetSkyColor(Color(0.8f, 0.9f, 1.0f));
    
    // Materials
    const int nummtls=4;
    AshikhminMaterial mtl[nummtls];
    
    // Diffuse
    mtl[0].SetSpecularLevel(0.0f);
    mtl[0].SetDiffuseLevel(1.0f);
    mtl[0].SetDiffuseColor(Color(0.7f,0.7f,0.7f));
    
    // Roughened copper
    mtl[1].SetDiffuseLevel(0.0f);
    mtl[1].SetSpecularLevel(1.0f);
    mtl[1].SetSpecularColor(Color(0.9f,0.6f,0.5f));
    mtl[1].SetRoughness(100.0f,100.0f);
    
    // Anisotropic gold
    mtl[2].SetDiffuseLevel(0.0f);
    mtl[2].SetSpecularLevel(1.0f);
    mtl[2].SetSpecularColor(Color(0.95f,0.7f,0.3f));
    mtl[2].SetRoughness(1.0f,1000.0f);
    
    // Red plastic
    mtl[3].SetDiffuseColor(Color(1.0f,0.1f,0.1f));
    mtl[3].SetDiffuseLevel(0.8f);
    mtl[3].SetSpecularLevel(0.2f);
    mtl[3].SetSpecularColor(Color(1.0f,1.0f,1.0f));
    mtl[3].SetRoughness(1000.0f,1000.0f);
    
    // Load dragon mesh
    MeshObject dragon;
    concat = APP_PATH + "data/dragon.ply";
    dragon.LoadPLY(concat.c_str());
    dragon.Smooth();
    
    // Create box tree
    BoxTreeObject tree;
    tree.Construct(dragon);
    
    // Create dragon instances
    Matrix34 mtx;
    
    MotionObject *minst = new MotionObject(tree);
    minst->SetMaterial(&mtl[0]);
    mtx.d.Set(0.0f,0.0f,0.0f);
    minst->SetInitialMatrix(mtx);
    mtx.d.Set(0.00f,0.0f,0.05f);
    minst->SetFinalMatrix(mtx);
    scn.AddObject(*minst);
    
    
    for(int i=1;i<nummtls;i++) {
        InstanceObject *inst = new InstanceObject(tree);
        mtx.d.Set(0.0f,0.0f,-0.1f*float(i));
        inst->SetMatrix(mtx);
        inst->SetMaterial(&mtl[i]);
        scn.AddObject(*inst);
    }
    
    // Create ground
    LambertMaterial lambert;
    lambert.SetDiffuseColor(Color(0.3f,0.3f,0.35f));
    MeshObject ground;
    ground.MakeBox(2.0f,0.11f,2.0f,&lambert);
    scn.AddObject(ground);
    
    // Create lights
    DirectLight sunlgt;
    sunlgt.SetBaseColor(Color(1.0f, 1.0f, 0.9f));
    sunlgt.SetIntensity(1.0f);
    Vector3 temp = Vector3(2.0f, -3.0f, -2.0f);
    sunlgt.SetDirection(temp);
    scn.AddLight(sunlgt);
    
    // Create camera
    Camera cam;
    cam.LookAt(Vector3(-0.5f,0.25f,-0.2f),Vector3(0.0f,0.15f,-0.15f),
               Vector3(0.0f, 1.0f, 0.0f));
    cam.SetFOV(40.0f); cam.SetAspect(1.33f);
    cam.SetResolution(800,600);
    cam.SetSuperSample(7);
    
    // Render image
    cam.Render(scn);
    concat = APP_PATH + "project3_extra2.bmp";
    cam.SaveBitmap(concat.c_str());
}


////////////////////////////////////////////////////////////////////////////////