////////////////////////////////////////////////////////////////////////////////
// UCSD CSE 168 - basic ray tracer
// Author: Monica Liu
// Spring 2014
////////////////////////////////////////////////////////////////////////////////

////////////////////////////////////////////////////////////////////////////////
//scene generation
////////////////////////////////////////////////////////////////////////////////


void finalProject() {
    // Create scene
    Scene scn;
    
        // used photoshop color spectrum to select colors
        Color c;
        //clouds
        LambertMaterial cl;
        c.FromInt(0xb2daed);
        cl.SetDiffuseColor(c);
        cl.SetDiffuseLevel(0.8f);
        CloudTexture cloud = CloudTexture();
    scn.SetSkyColor(Color(0.8f, 0.9f, 1.0f));
    scn.SetSkyTexture(&cloud);


    // Load LordHelix mesh
    MeshObject LordHelix;
    concat = APP_PATH + "data/LordHelix.ply";
    LordHelix.LoadPLY(concat.c_str());
    LordHelix.Smooth();
    
    // Load BabyHelix mesh
    MeshObject BabyHelix;
    concat = APP_PATH + "data/BabyHelix.ply";
    BabyHelix.LoadPLY(concat.c_str());
    BabyHelix.Smooth();
    
    // Load Helix Fossil
    MeshObject HelixFossil;
    concat = APP_PATH + "data/HelixFossil.ply";
    HelixFossil.LoadPLY(concat.c_str());
    HelixFossil.Smooth();
    
    // Create box tree
    BoxTreeObject Lord;
    Lord.Construct(LordHelix);
    BoxTreeObject Baby;
    Baby.Construct(BabyHelix);
    BoxTreeObject fossil;
    fossil.Construct(HelixFossil);
    
    
////////////// Textures and Materials ///////////////////
    
    //marble texture color
    AshikhminMaterial m;
    m.SetDiffuseColor(c);
    m.SetDiffuseLevel(0.8f);
    m.SetSpecularLevel(0.2f);
    m.SetSpecularColor(Color(1.0f,1.0f,1.0f));
    m.SetRoughness(1000.0f,1000.0f);
    //marble texture
    MarbleTexture marble = MarbleTexture(40.0f);
    
    //wood textured brown gloss material
    AshikhminMaterial w;
    c.FromInt(0x784b0b);
    w.SetDiffuseColor(c);
    w.SetDiffuseLevel(0.8f);
    w.SetSpecularLevel(0.2f);
    w.SetSpecularColor(Color(1.0f,1.0f,1.0f));
    w.SetRoughness(1000.0f,1000.0f);
    //wood texture
    WoodTexture wood = WoodTexture();
    
    // worley red texture color
    c.FromInt(0x8e1b1b);
    AshikhminMaterial la;
    la.SetDiffuseColor(c);
    la.SetDiffuseLevel(0.8f);
    la.SetSpecularLevel(0.2f);
    la.SetSpecularColor(Color(1.0f,1.0f,1.0f));
    la.SetRoughness(1000.0f,1000.0f);
    //lava texture
    CellTexture latex = CellTexture(10.0f, 5550, WorleyNoise::MANHATTAN, WorleyNoise::D3);
    
    // Diamond
    FresnelMaterial diamond;
    diamond.setAttenuation(1.0f, 4.0f, 1.0f);
    diamond.SetDiffuseLevel(0.0f);
    diamond.SetSpecularLevel(1.0f);
    diamond.SetSpecularColor(Color(1.0f, 1.0f, 1.0f));
    diamond.SetRefraction(1.0f, 2.417f);
    
    // ground
    CellTexture gro = CellTexture(1.0f, 1305, WorleyNoise::EUCLIDIAN, WorleyNoise::D1);
    LambertMaterial g;
    c.FromInt(0xc99968);
    g.SetDiffuseLevel(0.6f);
    g.SetDiffuseColor(c);
     
    
////////////// Objects in Scene ///////////////////
    Matrix34 mtx;
    InstanceObject *inst = new InstanceObject(Lord);
    mtx.d.Set(0.0f, 0.86f, 0.0f);
    inst->SetMatrix(mtx);
    inst->SetMaterial(&m);
    inst->SetTexture(&marble);
    scn.AddObject(*inst);
    
    InstanceObject *inst2 = new InstanceObject(Baby);
    mtx.d.Set(2.0f, 0.5f, 0.0f);
    inst2->SetMatrix(mtx);
    inst2->SetMaterial(&w);
    inst2->SetTexture(&wood);
    scn.AddObject(*inst2);

    InstanceObject *inst3 = new InstanceObject(Baby);
    mtx.d.Set(-2.0f, 0.5f, 0.0f);
    inst3->SetMatrix(mtx);
    inst3->SetMaterial(&la);
    inst3->SetTexture(&latex);
    scn.AddObject(*inst3);
    
    InstanceObject *inst4 = new InstanceObject(fossil);
    mtx.d.Set(0.0f, 0.2f, 3.0f);
    inst4->SetMatrix(mtx);
    inst4->SetMaterial(&diamond);
    scn.AddObject(*inst4);
    
    // Create ground plane
	PlaneObject ground;
    ground.SetMaterial(&g);
    ground.SetTexture(&gro);
	scn.AddObject(ground);
    
////////////// Camera and Lights ///////////////////
    // Create lights
    DirectLight sunlgt;
    sunlgt.SetBaseColor(Color(1.0f, 1.0f, 0.9f));
    sunlgt.SetIntensity(1.0f);
    Vector3 temp = Vector3(2.0f, -3.0f, -5.0f);
    sunlgt.SetDirection(temp);
    scn.AddLight(sunlgt);
    
    // Create camera
    Camera cam;
    cam.LookAt(Vector3(0.0f,1.0f, 6.0f),Vector3(0.0f,0.0f,-1.0f),
               Vector3(0.0f, 1.0f, 0.0f));
    cam.SetFOV(40.0f); cam.SetAspect(1.33f);
    cam.SetResolution(800,600);
    cam.SetSuperSample(7);
    
    //Render image
    cam.Render(scn);
    concat = APP_PATH + "FinalProject.bmp";
    cam.SaveBitmap(concat.c_str());
}